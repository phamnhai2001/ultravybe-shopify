<div class="js-wish-list">
  {% if customer %}
    {% assign value = product.selected_or_first_available_variant.id %}
    {% capture productID %}{{ product.selected_or_first_available_variant.id }}{% endcapture %}
    {% for tag in customer.tags %}
      {% capture tagID %}{{ tag }}{% endcapture %}
      {% if tagID contains productID %}
        {% capture value %}x{{ tagID }}{% endcapture %}
      {% endif %}
      {% if value.size == 0 %}{% assign value = productID %}{% endif %}
    {% endfor %}

    {% unless value.size == 0 %}
      {% capture check %}{{ value.size | minus:productID.size | money_without_currency | times:100 | divided_by:2 }}{% endcapture %}
      {% assign check = check | split:'.' %}
      {% if check[1] contains "5" %}{% assign display = false %}{% else %}{% assign display = true %}{% endif %}
    {% endunless %}
    <form accept-charset="UTF-8" id="wish-list" action="/contact" class="contact-form" method="post">
        <input name="form_type" type="hidden" value="customer">
        <input name="utf8" type="hidden" value="âœ“">
        <input type="hidden" name="contact[email]" value="{{ customer.email }}"/>
        <input id="update-me" type="hidden" name="contact[tags]" value="{{ value }}" />
        <button id="add_wish_list" data-variant-id="{{ value }}">Add Wish List</button>
      </form>
    {% if display %}
      
    {% else %}
      <p>This product is in your <a href="/pages/wish-list">wishlist</a></p>
    {% endif %}
  {% endif %}
</div>
<script>
  $('#add_wish_list').click(function(){
      var $el = $(this);
      var variantId = $el.data('variant-id');
      var $wishList = $(".js-wish-list");
      var currentURL = window.location.protocol + "//" + window.location.host + window.location.pathname;
      var newURL = currentURL + "?variant="+variantId;
      $.ajax({
        type: 'GET',
        url: newURL,
        success:function(data){
          $wishList.empty();
          var newData = $(data).find(".js-wish-list").html();
          $wishList.html(newData);
          // reset event listener for posting to wish list
          postToWishlist();
        }
      });
    });
  function postToWishlist() {
    $("#wish-list").submit(function(e) {
    console.log("DKM");
      e.preventDefault();
      var postData = $(this).serializeArray();
      var formURL = $(this).attr("action");
      console.log(postData);
      {% comment %} $.ajax({
        url : formURL,
        type: "POST",
        data : postData,
        success:function(data, textStatus) {
          console.log(textStatus);
          $('.js-wish-list').empty().html('<p>This product is in your <a href="/pages/wish-list">wishlist</a></p>');
        },
        error: function() {
          $(this).append("<p>I'm afraid that didn't work.</p>");
        }
      }); {% endcomment %}
    });
  }
</script>